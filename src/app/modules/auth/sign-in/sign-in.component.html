<!-- Terms of Service Modal -->
<div *ngIf="showTermsModal" class="fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50 p-4" (click)="showTermsModal = false">
    <div class="max-h-[90vh] w-full max-w-4xl overflow-y-auto rounded-lg bg-white shadow-xl" (click)="$event.stopPropagation()">
        <div class="sticky top-0 border-b border-gray-200 bg-white px-4 py-4 sm:px-6">
            <div class="flex items-center justify-between">
                <h2 class="text-xl font-bold text-gray-800 sm:text-2xl">Terms of Service</h2>
                <button (click)="showTermsModal = false" class="text-gray-400 hover:text-gray-600">
                    <mat-icon>close</mat-icon>
                </button>
            </div>
        </div>
        <div class="px-4 py-6 sm:px-6">
            <div class="prose max-w-none text-sm text-gray-700 sm:text-base">
                <p class="mb-4">
                    <strong>Terms of Use for Geminia Insurance Company Limited</strong>
                </p>
                <p class="mb-4">
                    By accessing and using the services provided by Geminia Insurance Company Limited, you agree to comply with and be bound by the following terms and conditions:
                </p>
                <div class="space-y-4">
                    <div>
                        <h3 class="font-semibold">1. Service Agreement</h3>
                        <p>These terms constitute a binding agreement between you and Geminia Insurance Company Limited regarding your use of our insurance services and platform.</p>
                    </div>
                    <div>
                        <h3 class="font-semibold">2. Eligibility</h3>
                        <p>You must be at least 18 years old and legally capable of entering into binding contracts to use our services.</p>
                    </div>
                    <div>
                        <h3 class="font-semibold">3. Accurate Information</h3>
                        <p>You agree to provide accurate, current, and complete information during registration and throughout your use of our services.</p>
                    </div>
                    <div>
                        <h3 class="font-semibold">4. Privacy and Data Protection</h3>
                        <p>Your privacy is important to us. Please review our Data Privacy Policy to understand how we collect, use, and protect your personal information.</p>
                    </div>
                    <div>
                        <h3 class="font-semibold">5. Service Availability</h3>
                        <p>We strive to maintain service availability but cannot guarantee uninterrupted access to our platform.</p>
                    </div>
                    <div>
                        <h3 class="font-semibold">6. Limitation of Liability</h3>
                        <p>Geminia Insurance Company Limited shall not be liable for any indirect, incidental, special, consequential, or punitive damages arising from your use of our services.</p>
                    </div>
                    <div>
                        <h3 class="font-semibold">7. Modifications</h3>
                        <p>We reserve the right to modify these terms at any time. Continued use of our services after modifications constitutes acceptance of the updated terms.</p>
                    </div>
                </div>
                <p class="mt-6 text-xs text-gray-500">
                    Last updated: {{ getCurrentDate() }}
                </p>
            </div>
        </div>
        <div class="sticky bottom-0 border-t border-gray-200 bg-white px-4 py-4 sm:px-6">
            <div class="flex justify-end">
                <button (click)="showTermsModal = false" class="rounded-md bg-sky-500 px-4 py-2 text-white hover:bg-sky-600">
                    Close
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Data Privacy Policy Modal -->
<div *ngIf="showDataPrivacyModal" class="fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50 p-4" (click)="showDataPrivacyModal = false">
    <div class="max-h-[90vh] w-full max-w-4xl overflow-y-auto rounded-lg bg-white shadow-xl" (click)="$event.stopPropagation()">
        <div class="sticky top-0 border-b border-gray-200 bg-white px-4 py-4 sm:px-6">
            <div class="flex items-center justify-between">
                <h2 class="text-xl font-bold text-gray-800 sm:text-2xl">Data Privacy Policy</h2>
                <button (click)="showDataPrivacyModal = false" class="text-gray-400 hover:text-gray-600">
                    <mat-icon>close</mat-icon>
                </button>
            </div>
        </div>
        <div class="px-4 py-6 sm:px-6">
            <div class="prose max-w-none text-sm text-gray-700 sm:text-base">
                <p class="mb-4">
                    <strong>Data Privacy Statement - Geminia Insurance Company Limited</strong>
                </p>
                <p class="mb-4">
                    Geminia Insurance Company Limited is committed to protecting the fundamental human right to privacy of those with whom we interact. We recognize the need to safeguard personal data that is collected or disclosed to us as part of the Know-your-customer information required by us in order to provide you with the requisite financial product or service.
                </p>
                <p class="mb-4">
                    We are committed to complying with the requirements of the Data Protection Act and the attendant regulations as well as best global best practices regarding the processing of your personal data. In this regard, you are required to acquaint yourselves with our data privacy statement which is intended to tell you how we use your personal data and describes how we collect and process your personal data during and after your relationship with us.
                </p>
                <div class="space-y-4">
                    <div>
                        <h3 class="font-semibold">Data Collection</h3>
                        <p>We collect personal data necessary for providing insurance services, including but not limited to identification information, contact details, and financial information required for Know Your Customer (KYC) compliance.</p>
                    </div>
                    <div>
                        <h3 class="font-semibold">Purpose of Processing</h3>
                        <p>Your personal data is processed for the following purposes:</p>
                        <ul class="ml-4 mt-2 list-disc space-y-1">
                            <li>Provision of insurance products and services</li>
                            <li>Compliance with regulatory requirements</li>
                            <li>Risk assessment and underwriting</li>
                            <li>Claims processing and settlement</li>
                            <li>Customer service and support</li>
                        </ul>
                    </div>
                    <div>
                        <h3 class="font-semibold">Data Security</h3>
                        <p>We implement appropriate technical and organizational measures to protect your personal data against unauthorized access, alteration, disclosure, or destruction.</p>
                    </div>
                    <div>
                        <h3 class="font-semibold">Your Rights</h3>
                        <p>You have the right to access, rectify, erase, or restrict processing of your personal data, as well as the right to data portability and to object to processing under certain circumstances.</p>
                    </div>
                    <div>
                        <h3 class="font-semibold">Data Retention</h3>
                        <p>We retain your personal data only for as long as necessary to fulfill the purposes for which it was collected or as required by applicable laws and regulations.</p>
                    </div>
                    <div>
                        <h3 class="font-semibold">Contact Information</h3>
                        <p>For more detailed information about our data processing practices, please visit:
                           <a href="https://geminia.co.ke/data-privacy-statement/" target="_blank"
                              class="break-all text-sky-500 hover:underline">
                              https://geminia.co.ke/data-privacy-statement/
                           </a>
                        </p>
                    </div>
                </div>
                <p class="mt-6 text-xs text-gray-500">
                    Last updated: {{ getCurrentDate() }}
                </p>
            </div>
        </div>
        <div class="sticky bottom-0 border-t border-gray-200 bg-white px-4 py-4 sm:px-6">
            <div class="flex justify-end">
                <button (click)="showDataPrivacyModal = false" class="rounded-md bg-sky-500 px-4 py-2 text-white hover:bg-sky-600">
                    Close
                </button>
            </div>
        </div>
    </div>
</div>

<div class="relative flex h-screen w-screen flex-col overflow-hidden">
    <!-- Bottom Right Toast Alert -->
    <div class="fixed bottom-4 right-4 z-50" *ngIf="showAlert">
        <fuse-alert class="login-toast show" [appearance]="'fill'" [showIcon]="true" [type]="alert.type">
            {{ alert.message }}
        </fuse-alert>
    </div>

        <!-- Geminia Get Quote Portal (Left/Top on mobile) -->
            <!-- Background -->
    <div class="flex min-w-0 flex-auto flex-col-reverse items-center sm:flex-row sm:justify-center md:items-start md:justify-start">
        <div class="relative flex min-h-[40vh] w-full flex-auto justify-center overflow-hidden p-6 sm:min-h-screen sm:w-1/2 sm:items-center sm:p-8 md:p-16 lg:px-28 dark:border-r" style="background-color: #04b2e1">
            <!-- Background Elements -->
            <div class="absolute inset-0 overflow-hidden">
                <div class="absolute -left-10 -top-10 h-40 w-40 animate-pulse rounded-full bg-white/10 blur-xl"></div>
                <div class="absolute -right-20 top-1/3 h-60 w-60 animate-bounce rounded-full bg-white/5 blur-2xl" style="animation-duration: 3s"></div>
            </div>

            <!-- Content -->
            <div class="relative z-10 w-full max-w-2xl">
                <div class="mb-6 flex justify-center sm:mb-8">
                    <img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcROTKn0j9cVpA67LPdjPeYBR3KnWiwP1gsM3cS27rca-7m8BgvgUylY4uhBnOnVnXFx8Is&usqp=CAU" alt="Geminia Insurance Logo" class="h-12 w-auto rounded-lg object-contain sm:h-16" style="mix-blend-mode: multiply; background: transparent;"/>
                </div>
                <div class="mb-2 text-center text-4xl font-bold leading-tight text-white sm:text-5xl md:text-6xl">
                    <div class="bg-gradient-to-r from-white to-blue-100 bg-clip-text text-transparent">Geminia Insurance</div>
                </div>
                <div class="mt-6 max-w-lg text-center text-lg leading-relaxed text-white/90">Get a quick quote —no login required.</div>

                <!-- Insurance Cards -->
                <div class="mt-10 space-y-6">
                    <div class="group rounded-2xl border border-white/20 bg-white/10 p-6 backdrop-blur-sm transition-all duration-300 hover:bg-white/15">
                        <div class="flex flex-col items-start justify-between gap-4 sm:flex-row sm:items-center sm:gap-0">
                            <div>
                                <h3 class="text-lg font-semibold text-white">Marine Insurance</h3>
                                <p class="text-sm text-white/70">Protect your vessels & cargo</p>
                            </div>
                            <a href="/sign-up/marine-quote" class="w-full cursor-pointer rounded-xl bg-black px-6 py-2.5 text-center font-medium text-white shadow-lg transition-all duration-200 hover:bg-gray-800 sm:w-auto">Get Quote</a>
                        </div>
                    </div>
                    <div class="group rounded-2xl border border-white/20 bg-white/10 p-6 backdrop-blur-sm transition-all duration-300 hover:bg-white/15">
                        <div class="flex flex-col items-start justify-between gap-4 sm:flex-row sm:items-center sm:gap-0">
                            <div>
                                <h3 class="text-lg font-semibold text-white">Travel Insurance</h3>
                                <p class="text-sm text-white/70">Comprehensive travel coverage</p>
                            </div>
                            <a href="/sign-up/travel-quote" class="w-full cursor-pointer rounded-xl bg-black px-6 py-2.5 text-center font-medium text-white shadow-lg transition-all duration-200 hover:bg-gray-800 sm:w-auto">Get Quote</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- MODIFIED: Login/Register Form container to prevent scrolling -->
        <div class="relative flex min-h-[60vh] w-full flex-auto flex-col items-center justify-center overflow-hidden bg-white p-4 sm:h-screen sm:p-6 md:w-1/2 md:p-8 lg:p-12">
            <div class="w-full max-w-sm px-2 sm:px-0">
                <!-- Login Form (unchanged) -->
                <div *ngIf="formType === 'login'" class="animate-fade-in">
                    <div class="mb-8 text-center">
                        <div class="text-2xl font-bold text-gray-800">Geminia Insurance</div>
                        <div class="mt-1 text-sm text-gray-500">Sign in to the Geminia Insurance Platform</div>
                    </div>
                    <form [formGroup]="signInForm" >
                        <!-- CREDENTIALS VIEW -->
                        <div *ngIf="loginState === 'credentials'">
                            <div class="mb-4">
                                <label class="mb-2 block text-sm font-medium text-gray-700">Email Address</label>
                                <input type="email" class="w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-sky-500 focus:ring-sky-500" formControlName="username" placeholder="your-email@geminia.com"/>
                            </div>
                            <div class="mb-4">
                                <label class="mb-2 block text-sm font-medium text-gray-700">Password</label>
                                <div class="relative">
                                    <input [type]="showPassword ? 'text' : 'password'" class="w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-sky-500 focus:ring-sky-500" formControlName="password" placeholder="Password"/>
                                    <button type="button" class="absolute inset-y-0 right-0 flex items-center pr-3 text-gray-400 hover:text-gray-600" (click)="togglePasswordVisibility()"><mat-icon class="text-base">{{ showPassword ? 'visibility_off' : 'visibility' }}</mat-icon></button>
                                </div>
                            </div>
                            <div class="mb-4 flex items-center">
                                <mat-checkbox formControlName="agreementAccepted" id="signin-agreement" class="flex-shrink-0"></mat-checkbox>
                                <label for="signin-agreement" class="ml-2 text-sm text-gray-600">
                                    I agree to the
                                    <a href="#" class="font-medium text-sky-500 hover:underline" (click)="showTermsModal = true; $event.preventDefault()">Terms of Service</a>
                                    and
                                    <a href="#" class="font-medium text-sky-500 hover:underline" (click)="showDataPrivacyModal = true; $event.preventDefault()">Data Privacy Policy</a>.
                                </label>
                            </div>
                        </div>

                        <!-- OTP VIEW -->
                        <div *ngIf="loginState === 'otp'">
                             <div class="mb-4">
                                <label class="mb-2 block text-sm font-medium text-gray-700">Enter OTP Code</label>
                                <input type="text" class="w-full rounded-md border border-gray-300 px-3 py-2 text-center text-lg tracking-[.5em] shadow-sm focus:border-sky-500 focus:ring-sky-500" formControlName="otp" placeholder="_ _ _ _ _ _ _ _"/>
                                <div class="mt-2 flex items-center justify-between text-xs">
                                    <div class="flex items-center space-x-2">
                                        <span class="text-gray-500">Didn't receive code?</span>
                                        <button type="button"
                                                (click)="resendOtp()"
                                                [disabled]="resendCooldown > 0 || isResending"
                                                class="font-medium transition-colors"
                                                [ngClass]="{
                                                    'text-sky-500 hover:underline cursor-pointer': resendCooldown === 0 && !isResending,
                                                    'text-gray-400 cursor-not-allowed': resendCooldown > 0 || isResending
                                                }">
                                            <span *ngIf="!isResending && resendCooldown === 0">Resend OTP</span>
                                            <span *ngIf="!isResending && resendCooldown > 0">Resend in {{ resendCooldown }}s</span>
                                            <span *ngIf="isResending">Sending...</span>
                                        </button>
                                    </div>
                                    <a (click)="backToCredentials()" class="cursor-pointer font-medium text-sky-500 hover:underline">Back to login</a>
                                </div>
                            </div>
                            <div class="mb-4 flex items-center">
                                <mat-checkbox formControlName="agreementAccepted" id="signin-agreement" class="flex-shrink-0"></mat-checkbox>
                                <label for="signin-agreement" class="ml-2 text-sm text-gray-600">
                                    I agree to the
                                    <a href="#" class="font-medium text-sky-500 hover:underline" (click)="showTermsModal = true; $event.preventDefault()">Terms of Service</a>
                                    and
                                    <a href="#" class="font-medium text-sky-500 hover:underline" (click)="showDataPrivacyModal = true; $event.preventDefault()">Data Privacy Policy</a>.
                                </label>
                            </div>
                        </div>

                        <button type="button" (click)="handleSignIn()" class="mt-6 w-full rounded-md py-2.5 font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-offset-2" [ngClass]="{ 'bg-sky-500 text-white hover:bg-sky-600 focus:ring-sky-500': signInForm.valid, 'cursor-not-allowed bg-gray-200 text-gray-500': signInForm.invalid || signInForm.disabled, }" [disabled]="signInForm.invalid || signInForm.disabled">
                            <ng-container *ngIf="!signInForm.disabled; else signingIn">
                                <span *ngIf="loginState === 'credentials'">Sign In</span>
                                <span *ngIf="loginState === 'otp'">Verify Code</span>
                            </ng-container>
                            <ng-template #signingIn>
                                <div class="flex items-center justify-center">
                                    <mat-progress-spinner [diameter]="20" mode="indeterminate" class="mr-2"></mat-progress-spinner>
                                    <span *ngIf="loginState === 'credentials'">Signing in...</span>
                                    <span *ngIf="loginState === 'otp'">Verifying...</span>
                                </div>
                            </ng-template>
                        </button>
                    </form>
                    <div class="mt-6 flex items-center justify-between text-sm">
                        <a class="font-medium text-sky-500 hover:underline" routerLink="/forgot-password">Forgot password?</a>
                        <div>
                            <span class="text-gray-600">No account?</span>
                            <a class="ml-1 cursor-pointer font-medium text-sky-500 hover:underline" (click)="formType = 'register'">Register here</a>
                        </div>
                    </div>
                </div>

                <!-- MODIFIED: Registration Form with compact spacing -->
                <div *ngIf="formType === 'register'" class="animate-fade-in">
                    <div class="mb-2 text-center">
                        <div class="text-xl font-bold text-gray-800 sm:text-2xl">Create Your Account</div>
                        <div class="mt-1 text-xs text-gray-500 sm:text-sm">Fill in the details below to get started</div>
                    </div>
                    <form [formGroup]="registerForm" novalidate>
                        <div class="mb-2">
                            <label class="mb-1 block text-xs font-medium text-gray-700">Account Type</label>
                            <mat-radio-group class="flex space-x-4" formControlName="accountType"><mat-radio-button value="C">Individual</mat-radio-button><mat-radio-button value="A">Intermediary</mat-radio-button></mat-radio-group>
                        </div>
                        <div *ngIf="registerForm.get('accountType').value === 'C'">
                            <div class="mb-1">
                                <label class="mb-1 block text-xs font-medium text-gray-700">Full Name</label>
                                <input type="text"
                                       class="w-full rounded-md border px-2 py-1 text-sm shadow-sm focus:border-sky-500 focus:ring-sky-500"
                                       [class.border-red-300]="registerForm.get('fullName')?.invalid && registerForm.get('fullName')?.touched"
                                       [class.border-gray-300]="!(registerForm.get('fullName')?.invalid && registerForm.get('fullName')?.touched)"
                                       formControlName="fullName"
                                       placeholder="First Name Last Name"/>
                                <div *ngIf="registerForm.get('fullName')?.invalid && registerForm.get('fullName')?.touched"
                                     class="mt-0.5 text-xs text-red-500">
                                    <span *ngIf="registerForm.get('fullName')?.errors?.['required']">Full name is required</span>
                                    <span *ngIf="registerForm.get('fullName')?.errors?.['fullNameInvalid']">Please enter at least two names separated by a space</span>
                                </div>
                            </div>
                            <div class="mb-1">
                                <label class="mb-1 block text-xs font-medium text-gray-700">Email Address</label>
                                <input type="email"
                                       class="w-full rounded-md border px-2 py-1 text-sm shadow-sm focus:border-sky-500 focus:ring-sky-500"
                                       [class.border-red-300]="registerForm.get('email')?.invalid && registerForm.get('email')?.touched"
                                       [class.border-gray-300]="!(registerForm.get('email')?.invalid && registerForm.get('email')?.touched)"
                                       formControlName="email"
                                       placeholder="your-email@example.com"/>
                                <div *ngIf="registerForm.get('email')?.invalid && registerForm.get('email')?.touched"
                                     class="mt-0.5 text-xs text-red-500">
                                    <span *ngIf="registerForm.get('email')?.errors?.['required']">Email is required</span>
                                    <span *ngIf="registerForm.get('email')?.errors?.['email']">Please enter a valid email address</span>
                                </div>
                            </div>
                            <div class="mb-1">
                                <label class="mb-1 block text-xs font-medium text-gray-700">KRA PIN</label>
                                <input type="text"
                                       class="w-full rounded-md border px-2 py-1 text-sm shadow-sm focus:border-sky-500 focus:ring-sky-500"
                                       [class.border-red-300]="registerForm.get('kraPin')?.invalid && registerForm.get('kraPin')?.touched"
                                       [class.border-gray-300]="!(registerForm.get('kraPin')?.invalid && registerForm.get('kraPin')?.touched)"
                                       formControlName="kraPin"
                                       placeholder="A123456789M"
                                       (input)="onKraPinChange($event)"
                                       maxlength="11"/>
                                <div *ngIf="registerForm.get('kraPin')?.invalid && registerForm.get('kraPin')?.touched"
                                     class="mt-0.5 text-xs text-red-500">
                                    <span *ngIf="registerForm.get('kraPin')?.errors?.['required']">KRA PIN is required</span>
                                    <span *ngIf="registerForm.get('kraPin')?.errors?.['kraPinInvalid']">Format: A123456789M</span>
                                </div>
                                <div class="mt-0.5 text-xs text-gray-500">Letter + 9 digits + Letter (e.g., A123456789M)</div>
                            </div>
                            <div class="mb-1">
                                <label class="mb-1 block text-xs font-medium text-gray-700">Phone Number</label>
                                <input type="tel"
                                       class="w-full rounded-md border px-2 py-1 text-sm shadow-sm focus:border-sky-500 focus:ring-sky-500"
                                       [class.border-red-300]="registerForm.get('phoneNumber')?.invalid && registerForm.get('phoneNumber')?.touched"
                                       [class.border-gray-300]="!(registerForm.get('phoneNumber')?.invalid && registerForm.get('phoneNumber')?.touched)"
                                       formControlName="phoneNumber"
                                       placeholder="+254712345678"
                                       (input)="onPhoneNumberChange($event)"
                                       maxlength="13"/>
                                <div *ngIf="registerForm.get('phoneNumber')?.invalid && registerForm.get('phoneNumber')?.touched"
                                     class="mt-0.5 text-xs text-red-500">
                                    <span *ngIf="registerForm.get('phoneNumber')?.errors?.['required']">Phone number is required</span>
                                    <span *ngIf="registerForm.get('phoneNumber')?.errors?.['phoneNumberInvalid']">Enter +254 followed by 9-12 digits</span>
                                </div>
                                <div class="mt-0.5 text-xs text-gray-500">Kenyan format: +254 followed by 9-12 digits</div>
                            </div>
                        </div>
                        <div *ngIf="registerForm.get('accountType').value === 'A'">
                            <div class="mb-1">
                                <label class="mb-1 block text-xs font-medium text-gray-700">Intermediary - IRA Number</label>
                                <input type="text"
                                       class="w-full rounded-md border border-gray-300 px-2 py-1 text-sm shadow-sm focus:border-sky-500 focus:ring-sky-500"
                                       formControlName="iraNumber"
                                       placeholder="IRA Number"/>
                            </div>
                            <div class="mb-1">
                                <label class="mb-1 block text-xs font-medium text-gray-700">PIN Number</label>
                                <input type="text"
                                       class="w-full rounded-md border border-gray-300 px-2 py-1 text-sm shadow-sm focus:border-sky-500 focus:ring-sky-500"
                                       formControlName="pinNumber"
                                       placeholder="PIN Number"/>
                            </div>
                        </div>
                        <div class="mb-1">
                            <label class="mb-1 block text-xs font-medium text-gray-700">Password</label>
                            <div class="relative">
                                <input [type]="showPassword ? 'text' : 'password'"
                                       class="w-full rounded-md border px-2 py-1 pr-8 text-sm shadow-sm focus:border-sky-500 focus:ring-sky-500"
                                       [class.border-red-300]="registerForm.get('password')?.invalid && registerForm.get('password')?.touched"
                                       [class.border-gray-300]="!(registerForm.get('password')?.invalid && registerForm.get('password')?.touched)"
                                       formControlName="password"
                                       placeholder="Create a strong password"
                                       required/>
                                <button type="button"
                                        class="absolute inset-y-0 right-0 flex items-center pr-2 text-gray-400 hover:text-gray-600"
                                        (click)="togglePasswordVisibility()">
                                    <mat-icon class="text-sm">{{ showPassword ? 'visibility_off' : 'visibility' }}</mat-icon>
                                </button>
                                    </div>
                        </div>
                        <div class="mb-1">
                            <label class="mb-1 block text-xs font-medium text-gray-700">Confirm Password</label>
                            <div class="relative">
                                <input [type]="showPassword ? 'text' : 'password'"
                                       class="w-full rounded-md border px-2 py-1 pr-8 text-sm shadow-sm focus:border-sky-500 focus:ring-sky-500"
                                       [class.border-red-300]="registerForm.get('confirmPassword')?.invalid && registerForm.get('confirmPassword')?.touched"
                                       [class.border-gray-300]="!(registerForm.get('confirmPassword')?.invalid && registerForm.get('confirmPassword')?.touched)"
                                       formControlName="confirmPassword"
                                       placeholder="Confirm your password"
                                       required/>
                                <button type="button"
                                        class="absolute inset-y-0 right-0 flex items-center pr-2 text-gray-400 hover:text-gray-600"
                                        (click)="togglePasswordVisibility()">
                                    <mat-icon class="text-sm">{{ showPassword ? 'visibility_off' : 'visibility' }}</mat-icon>
                                </button>
                            </div>
                            <p class="mt-1 text-xs text-red-600" *ngIf="registerForm.errors?.passwordMismatch && confirmPassword?.touched">
                                Passwords do not match
                            </p>
                        </div>
                        <div class="mb-2 flex items-start">
                            <mat-checkbox formControlName="agreementAccepted" id="register-agreement" class="mt-0.5 flex-shrink-0"></mat-checkbox>
                            <label for="register-agreement" class="ml-2 text-xs leading-relaxed text-gray-600">
                                I agree to the
                                <a href="#" class="font-medium text-sky-500 hover:underline" (click)="showTermsModal = true; $event.preventDefault()">Terms of Service</a>
                                and
                                <a href="#" class="font-medium text-sky-500 hover:underline" (click)="showDataPrivacyModal = true; $event.preventDefault()">Data Privacy Policy</a>.
                            </label>
                        </div>
                        <button type="button" (click)="register()"
                                class="mt-2 w-full rounded-md py-2 font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-offset-2"
                                [ngClass]="{ 'bg-sky-500 text-white hover:bg-sky-600 focus:ring-sky-500': registerForm.valid,
                         'cursor-not-allowed bg-gray-200 text-gray-500': registerForm.invalid || registerForm.disabled }"
                                [disabled]="registerForm.invalid || registerForm.disabled">

                            <ng-container *ngIf="!registerForm.disabled; else registering">
                                Create Account
                            </ng-container>
                            <ng-template #registering>
                                <div class="flex items-center justify-center">
                                    <mat-progress-spinner [diameter]="20" mode="indeterminate" class="mr-2"></mat-progress-spinner>
                                    <span>Creating account...</span>
                                </div>
                            </ng-template>
                        </button>
                    </form>
                    <div class="mt-2 text-center text-sm">
                        <span class="text-gray-600">Already have an account?</span>
                        <a class="ml-1 cursor-pointer font-medium text-sky-500 hover:underline" (click)="formType = 'login'">Sign In</a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>